<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Morris</title>
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#111827;
      --muted:#4b5563;
      --accent:#2563eb;
      --border:#e5e7eb;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:'Atkinson Hyperlegible','Lexend','Noto Sans SC','Source Han Sans SC','Microsoft YaHei UI','Microsoft YaHei','PingFang SC',system-ui,-apple-system,'Segoe UI',Arial,sans-serif;}
    .wrap{max-width:1100px;margin:0 auto;padding:18px 18px 60px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    select{padding:8px 10px;border-radius:10px;border:1px solid var(--border);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:16px}
    @media (min-width: 980px){ .grid{grid-template-columns:1fr 1fr 1fr;} }
    .col{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px}
    .col h2{font-size:15px;margin:0 0 8px}
    .text{font-size:18px;line-height:2.0;letter-spacing:.2px;max-width:44rem}
    .text p{margin:0 0 12px}

    /* DFT flashcard */
    .cardbox{border:1px solid var(--border);border-radius:14px;background:rgba(37,99,235,.03);padding:12px}
    .cardtext{font-size:20px;line-height:2.05;letter-spacing:.2px}
    .controls{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px}
    .btn{background:rgba(37,99,235,.08);border:1px solid rgba(37,99,235,.22);color:var(--text);padding:8px 12px;border-radius:12px;font-size:14px;cursor:pointer}
    .btn:disabled{opacity:.35;cursor:not-allowed}
    .btn.secondary{background:transparent;border:1px solid var(--border);color:var(--muted)}
    .page{color:var(--muted);font-size:13px}
    .full{display:none;margin-top:10px}
    mark.hl{background: rgba(250, 204, 21, .35); border:1px solid rgba(250, 204, 21, .60); padding:0 3px; border-radius:6px; color:var(--text)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <select id="itemSelect"></select>
    </div>

    <div class="grid">
      <div class="col">
        <h2>原文（未改写）</h2>
        <div id="colOriginal" class="text"></div>
      </div>
      <div class="col">
        <h2>Dyslexia Helper</h2>
        <div id="colHelper" class="text"></div>
      </div>
      <div class="col">
        <h2>DFT-GEN</h2>
        <div class="cardbox">
          <div id="dftCardText" class="cardtext"></div>
          <div class="controls">
            <button id="btnPrev" class="btn" type="button">←</button>
            <div id="page" class="page">1 / 1</div>
            <button id="btnNext" class="btn" type="button">→</button>
          </div>
          <div style="margin-top:10px">
            <button id="btnToggleFull" class="btn secondary" type="button">查看全文</button>
            <div id="dftFull" class="full text"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const ITEMS = [{"title": "掐丝珐琅缠枝莲纹冲耳三足炉", "original_html": "<p>掐丝珐琅缠枝莲纹冲耳三足炉，元末明初，通高20.5厘米，口径15.3厘米。炉仿古鼎式，冲耳，三柱足。炉口沿下一周草绿色釉地上饰缠枝白色小花，腹部施宝蓝色釉为地，饰紫、黄、深紫、白、红、黄缠枝莲花六朵，三足及炉底均饰花卉纹。炉内、口沿及双耳鎏金。此器釉色丰富纯正，有红、白、黄、草绿、紫、翠绿、宝蓝七种，其中绿釉如翡翠，蓝釉如宝石，为元末明初的仿古佳作。三足及器里为后配。</p>", "helper_html": "<p>这是一个元末明初的香炉。  <br>它高20.5厘米，宽15.3厘米。  <br>炉子仿照古代鼎的样式。  <br>它有两只立耳，三个柱形足。  <br>口沿下一圈画着绿色缠枝小白花。  <br>炉身主要是宝蓝色。  <br>上面画有六朵彩色缠枝莲花。  <br>莲花颜色有紫、黄、白、红等。  <br>三个足和炉底也画有花纹。  <br>炉口内侧和双耳都镀了金。  <br>釉色丰富纯正，共有七种颜色。  <br>其中绿色像翡翠，蓝色像宝石。  <br>这是元末明初的仿古精品。  <br>三个足和炉内底部是后来配上的。</p>", "dft_full_html": "<p>掐丝珐琅缠枝莲纹象耳炉，元末明初，通高13.9厘米，口径16厘米，足径13.5厘米。 此炉为掐丝珐琅器，其装饰主题为缠枝莲纹，器型特征为双象耳。器物通高13.9厘米，口径16厘米，足径13.5厘米。 炉为圆形，鼓腹，圈足。炉身两侧设象首形耳，象鼻向内卷曲，造型生动。 炉颈部在浅蓝釉地上，饰有十二朵菊花。 炉颈部指香炉的颈项部分。其底色为淡雅的浅蓝色釉彩。 菊花共运用了四种釉色描绘：黄、白、红、紫。 十二朵菊花装饰于此，色彩明丽，与浅蓝地子相映成趣。 腹部于宝蓝釉地上，以红、白、黄三色绘制缠枝莲花纹，共六朵。 其下饰莲瓣纹一周。 此器物为元代佳作，制作工艺精湛。 器表釉质莹润，质感温润如玉。 釉层部分呈现玻璃质感，清透半透明。 珐琅彩釉色泽搭配和谐，风格富丽典雅。 这件器物只有三个部分是后来配上的：铜胆、象耳和圈足。</p>", "dft_text": "掐丝珐琅缠枝莲纹象耳炉，元末明初，通高13.9厘米，口径16厘米，足径13.5厘米。 此炉为掐丝珐琅器，其装饰主题为缠枝莲纹，器型特征为双象耳。器物通高13.9厘米，口径16厘米，足径13.5厘米。 炉为圆形，鼓腹，圈足。炉身两侧设象首形耳，象鼻向内卷曲，造型生动。 炉颈部在浅蓝釉地上，饰有十二朵菊花。 炉颈部指香炉的颈项部分。其底色为淡雅的浅蓝色釉彩。 菊花共运用了四种釉色描绘：黄、白、红、紫。 十二朵菊花装饰于此，色彩明丽，与浅蓝地子相映成趣。 腹部于宝蓝釉地上，以红、白、黄三色绘制缠枝莲花纹，共六朵。 其下饰莲瓣纹一周。 此器物为元代佳作，制作工艺精湛。 器表釉质莹润，质感温润如玉。 釉层部分呈现玻璃质感，清透半透明。 珐琅彩釉色泽搭配和谐，风格富丽典雅。 这件器物只有三个部分是后来配上的：铜胆、象耳和圈足。"}, {"title": "磁山文化红陶平底碗", "original_html": "<p>红陶平底碗，新石器时代磁山文化，高6.7厘米，口径18.2厘米，底径6.4厘米。碗敞口，口以下渐内收，平底。泥质红陶，胎壁薄厚不均。磁山文化陶器以红陶为主，碗是其中较常见的器形之一。此碗制作工艺明显带有新石器时代中期陶器的特征。磁山文化因最初于1973年发现于河北省武安县磁山村而得名。据科学测试，其年代约为公元前6000～前5600年，属于华北地区新石器时代中期文化遗存。</p>", "helper_html": "<p>这是一个红陶做的碗。  <br>它来自新石器时代。  <br>属于磁山文化。  <br>碗高约6.7厘米。  <br>碗口宽约18.2厘米。  <br>底部宽约6.4厘米。  <br>碗口微微向外敞开。  <br>碗身慢慢向内收。  <br>底部是平的。  <br>用红陶泥制作。  <br>陶壁厚薄不太均匀。  <br>磁山文化陶器多为红陶。  <br>碗是当时常见的用具。  <br>制作方式有中期新石器时代特点。  <br>磁山文化最早在1973年发现。  <br>发现于河北武安磁山村。  <br>科学测定距今约8000-7600年。  <br>属于华北地区新石器时代中期文化。</p>", "dft_full_html": "<p>红陶平底碗，新石器时代磁山文化器物，高6.7厘米，口径18.2厘米，底径6.4厘米。 此碗为红陶质地，器型简洁。口沿外敞，底部平坦，素面无纹饰。 其尺寸具体：高6.7厘米，口径18.2厘米，底径6.4厘米。 这件红陶平底碗是磁山文化的典型器物，见证了约七千多年前先民的日常生活，用于盛放食物或水，是早期农耕文明的实物遗存。 这只碗敞口，口沿以下器壁逐渐向内收敛，底部平整。 这是一个泥质红陶器，其胎壁薄厚不均。 磁山文化陶器以红陶为主，碗是其中较常见的器形之一。 这只碗的制作工艺，具有新石器时代中期陶器的典型特征。 磁山文化得名于其首次发现地——河北省武安县磁山村，该遗址于1973年被发现。 据科学测定，其年代约为公元前6000年至前5600年，属于华北地区新石器时代中期的文化遗存。</p>", "dft_text": "红陶平底碗，新石器时代磁山文化器物，高6.7厘米，口径18.2厘米，底径6.4厘米。 此碗为红陶质地，器型简洁。口沿外敞，底部平坦，素面无纹饰。 其尺寸具体：高6.7厘米，口径18.2厘米，底径6.4厘米。 这件红陶平底碗是磁山文化的典型器物，见证了约七千多年前先民的日常生活，用于盛放食物或水，是早期农耕文明的实物遗存。 这只碗敞口，口沿以下器壁逐渐向内收敛，底部平整。 这是一个泥质红陶器，其胎壁薄厚不均。 磁山文化陶器以红陶为主，碗是其中较常见的器形之一。 这只碗的制作工艺，具有新石器时代中期陶器的典型特征。 磁山文化得名于其首次发现地——河北省武安县磁山村，该遗址于1973年被发现。 据科学测定，其年代约为公元前6000年至前5600年，属于华北地区新石器时代中期的文化遗存。"}];
    const sel = document.getElementById('itemSelect');
    const colO = document.getElementById('colOriginal');
    const colH = document.getElementById('colHelper');
    const dftCardText = document.getElementById('dftCardText');
    const dftFull = document.getElementById('dftFull');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const btnToggleFull = document.getElementById('btnToggleFull');
    const page = document.getElementById('page');

    let units = [];
    let idx = 0;
    let terms = [];

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    function escReg(s) {
      return String(s).replace(/[.*+?^{}()|[\]\\]/g, '\\$&');
    }

    function autoHighlight(html) {
      // 《...》 + years / numbers with common units
      html = html.replace(/(《[^》]{1,24}》)/g, '<mark class="hl">$1</mark>');
      html = html.replace(/(\b\d{3,4}\b)/g, '<mark class="hl">$1</mark>');
      html = html.replace(/(\d+(?:\.\d+)?\s*(?:厘米|年|克|公斤|件|朵|个|只|处|次|朝|代))/g, '<mark class="hl">$1</mark>');
      return html;
    }

    function extractTermsFromText(title, text) {
      // Very light-weight keyword extraction:
      // - include title (first 12 chars)
      // - include frequent 2-6 Chinese-char sequences (excluding stopwords)
      const t = String(text || '').replace(/\s+/g,'').trim();
      const counts = new Map();
      const stop = new Set([
        '这是','这件','器物','因此','可以','用于','属于','时代','文化','厘米','口径','底径','通高','一种',
        '主要','其中','以及','因为','所以','但是','同时','需要','一个','一些','这个','这些','我们',
        '其','其一','其二','的是','为','在','与','和','或','并','等','上','下','中','内','外'
      ]);

      const tt = String(title || '').trim();
      if(tt) {
        const head = tt.length > 12 ? tt.slice(0, 12) : tt;
        counts.set(head, 9999);
      }

      const m = t.match(/[\u4e00-\u9fff]{2,6}/g) || [];
      for(const w of m) {
        if(stop.has(w)) continue;
        counts.set(w, (counts.get(w) || 0) + 1);
      }

      const arr = Array.from(counts.entries())
        .filter(([w, c]) => w && c >= 2)
        .sort((a,b) => b[1]-a[1] || b[0].length - a[0].length)
        .slice(0, 10)
        .map(([w]) => w);

      // Always keep title head at front if present
      if(tt) {
        const head = tt.length > 12 ? tt.slice(0, 12) : tt;
        if(!arr.includes(head)) arr.unshift(head);
      }
      // Dedup + sort by length desc for replacement safety
      const uniq = Array.from(new Set(arr)).filter(Boolean);
      uniq.sort((a,b)=>b.length-a.length);
      return uniq;
    }

    function applyHighlight(text) {
      let html = escapeHtml(text);
      for(const t of terms) {
        if(!t) continue;
        const re = new RegExp(escReg(t), 'g');
        html = html.replace(re, '<mark class="hl">' + escapeHtml(t) + '</mark>');
      }
      html = autoHighlight(html);
      return html.replace(/\n/g,'<br>');
    }

    function splitByPunct(text) {
      const t = (text || '').replace(/\s+/g, ' ').trim();
      if(!t) return [];
      const parts = t.split(/([。！？；])/);
      const out = [];
      for(let i=0;i<parts.length;i+=2){
        const seg = (parts[i] || '').trim();
        const p = parts[i+1] || '';
        const s = (seg + p).trim();
        if(s) out.push(s);
      }
      return out;
    }

    function splitUnits(text, maxLen) {
      const raw = (text || '').replace(/\r\n/g,'\n').replace(/\r/g,'\n');
      const cleaned = raw.replace(/<[^>]+>/g,'').replace(/\s+/g,'').trim();
      if(!cleaned) return [];
      const sents = splitByPunct(cleaned);
      const out = [];
      for(const s of sents){
        if(s.length <= maxLen){ out.push(s); continue; }
        const subs = s.split(/([，、；])/);
        let cur = '';
        for(let i=0;i<subs.length;i+=2){
          const seg = (subs[i] || '');
          const p = subs[i+1] || '';
          const piece = (seg + p);
          if(!piece) continue;
          if((cur + piece).length <= maxLen){
            cur += piece;
          } else {
            if(cur) out.push(cur);
            cur = piece;
          }
        }
        if(cur) out.push(cur);
      }
      return out.filter(x => x && x.trim());
    }

    function updateCard() {
      const total = Math.max(1, units.length);
      if(!units.length) {
        dftCardText.textContent = '(空)';
        idx = 0;
      } else {
        idx = Math.max(0, Math.min(idx, total - 1));
        dftCardText.innerHTML = applyHighlight(units[idx]);
      }
      page.textContent = (idx + 1) + ' / ' + total;
      btnPrev.disabled = idx <= 0;
      btnNext.disabled = idx >= total - 1;
    }

    btnPrev.addEventListener('click', () => { idx -= 1; updateCard(); });
    btnNext.addEventListener('click', () => { idx += 1; updateCard(); });
    btnToggleFull.addEventListener('click', () => {
      if(dftFull.style.display === 'block') {
        dftFull.style.display = 'none';
        btnToggleFull.textContent = '查看全文';
      } else {
        dftFull.style.display = 'block';
        btnToggleFull.textContent = '收起全文';
      }
    });

    function renderFull(text) {
      const cleaned = String(text || '').replace(/\r\n/g,'\n').replace(/\r/g,'\n').trim();
      const sents = splitByPunct(cleaned.replace(/\s+/g,''));
      const html = '<div>' + (sents.length ? sents : [cleaned]).map(s => '<p>' + applyHighlight(s) + '</p>').join('') + '</div>';
      dftFull.innerHTML = html;
    }

    function render(idx) {
      const it = ITEMS[idx];
      colO.innerHTML = it.original_html;
      colH.innerHTML = it.helper_html;
      terms = extractTermsFromText(it.title, it.dft_text);
      renderFull(it.dft_text);
      units = splitUnits(it.dft_text, 22);
      idx = 0;
      dftFull.style.display = 'none';
      btnToggleFull.textContent = '查看全文';
      updateCard();
    }

    function init() {
      ITEMS.forEach((it, i) => {
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = it.title;
        sel.appendChild(opt);
      });
      sel.addEventListener('change', () => render(parseInt(sel.value, 10)));
      render(0);
    }
    init();
  </script>
</body>
</html>
